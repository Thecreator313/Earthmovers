<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #ffffff;
        }
        .container {
            padding: 20px;
        }
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 20px;
            background-color: #1f1f1f;
        }
        .header i {
            color: #ffffff;
        }
        .header .title {
            font-size: 18px;
        }
        .header .status {
            color: #00c853;
        }
        .content {
            background-color: #1f1f1f;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .content .type {
            font-size: 14px;
            color: #b0b0b0;
        }
        .content .amount {
            font-size: 48px;
            color: #00e676;
            margin: 10px 0;
        }
        .content .date_and_time {
            font-size: 14px;
            color: #b0b0b0;
            text-align: right;
        }
        .content .client {
            font-size: 16px;
            margin: 10px 0;
        }
        .content .client span {
            color: #b0b0b0;
        }
        .content .cash-button {
            display: inline-block;
            padding: 5px 10px;
            background-color: #37474f;
            color: #ffffff;
            border-radius: 5px;
            font-size: 14px;
        }
        .content .edit-entry {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
            color: #536dfe;
            font-size: 16px;
        }
        .content .edit-entry i {
            margin-right: 5px;
        }
        .information {
            background-color: #1f1f1f;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .information .label {
            font-size: 14px;
            color: #b0b0b0;
        }
        .information .value {
            font-size: 16px;
            color: #536dfe;
            text-align: right;
        }

        
        
   /* Bottom Sheet styles */
.bottom-sheet {
    position: fixed;
    bottom: -100%;
    left: 0;
    right: 0;
    border-radius: 20px 20px 0 0;
    background: #2c3e50;
    padding: 20px;
    width: 90%;
    color: #ecf0f1;
    overflow-y: auto;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2);
    transition: bottom 0.3s ease-out;
    z-index: 9999;
}


.modern-button {
    background-color: #00509d;
    color: white;
    border: none;
    padding: 10px 20px;
    font-size: 16px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.modern-button:hover {
    background-color: #003f88;
}

.modern-button.secondary {
    background-color: #ccc;
    color: #000;
}

.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.modal.hidden {
    display: none;
}

.modal-content {
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    width: 90%;
    max-width: 500px;
    text-align: center;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

.modal-actions {
    margin-top: 20px;
    display: flex;
    justify-content: space-between;
}

/* Content within the bottom sheet */
.sheet-content {
    position: relative;
    overflow-y: auto;
    max-height: 80vh;
}

/* Close Button */
.close-btn {
    position: absolute;
    top: 15px;
    right: 30px;
    background: none;
    border: none;
    font-size: 40px;
    color: #ffffff;
    cursor: pointer;
}

/* Heading styles */
h3 {
    font-size: 24px;
    color: #eeeeee;
    margin-bottom: 20px;
}

/* Dynamic field styles */
#typeFields {
    margin-bottom: 20px;
    width:90%
}

label {
    display: block;
    margin: 10px 0 5px;
    font-size: 16px;
    color: #666;
}

input[type="date"],
input[type="time"],
input[type="number"],
input[type="text"] {
    width: 100%;
    padding: 10px;
    margin: 5px 0 15px;
    border-radius: 8px;
    border: 1px solid #ddd;
    font-size: 16px;
}

input[type="checkbox"] {
    margin-right: 10px;
}

/* Save button */
.save-button {
    width: 95%;
    padding: 12px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 18px;
    cursor: pointer;
}

.save-button:hover {
    background-color: #0056b3;
}

/* Modal show effect */
.bottom-sheet.open {
    bottom: 0;
}

/* Optional: Adding overlay background */
.overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.3);
    z-index: 9998;
}

.confirm-modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #1f1f1f;
    color: #ffffff;
    padding: 20px;
    border-radius: 10px;
    width: 90%;
    max-width: 400px;
    text-align: center;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    z-index: 9999;
}

.confirm-modal h3 {
    margin-bottom: 10px;
    font-size: 20px;
    color: #e74c3c;
}

.confirm-modal p {
    margin-bottom: 20px;
    font-size: 16px;
    color: #bdc3c7;
}

.modal-actions {
    display: flex;
    justify-content: space-between;
}

.cancel-button,
.confirm-button {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
}

.cancel-button {
    background-color: #95a5a6;
    color: #ffffff;
}

.confirm-button {
    background-color: #e74c3c;
    color: #ffffff;
}

.confirm-button:hover {
    background-color: #c0392b;
}

.cancel-button:hover {
    background-color: #7f8c8d;
}



        .share-entry {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
            background-color: #00e676;
            color: #000000;
            font-size: 16px;
            border-radius: 5px;
            margin: 20px;
        }
        .share-entry i {
            margin-right: 10px;
        }
    </style>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
    import { getDatabase,remove, update, get, ref } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-database.js";

    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyDCjhSeMR3MhCvm-OMqqUeGk8X7DQjeDF4",
        authDomain: "al-ameen-c9a84.firebaseapp.com",
        databaseURL: "https://al-ameen-c9a84-default-rtdb.firebaseio.com/",
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    document.addEventListener("DOMContentLoaded", async () => {
        const urlParams = new URLSearchParams(window.location.search);
        const clientKey = urlParams.get("clientKey");
        const entryKey = urlParams.get("entryKey");

        if (!clientKey || !entryKey) {
            alert("Invalid request. Missing clientKey or entryKey.");
            return;
        }

        try {
            const clientRef = ref(database, `clients/${clientKey}`);
            const snapshot = await get(clientRef);

            if (snapshot.exists()) {
                const clientData = snapshot.val();
                let entryData = null;
                let entryPath = null;
            // Display client name
            const clientNameElement = document.querySelector(".content .client");
            clientNameElement.textContent = clientData.name || "Unknown Client";
                // Determine the correct entry location
                if (clientData.workDetails && clientData.workDetails[entryKey]) {
                    entryData = clientData.workDetails[entryKey];
                    entryPath = `clients/${clientKey}/workDetails/${entryKey}`;
                } else if (clientData.paymentReceived && clientData.paymentReceived[entryKey]) {
                    entryData = clientData.paymentReceived[entryKey];
                    entryPath = `clients/${clientKey}/paymentReceived/${entryKey}`;
                } else if (clientData.discount && clientData.discount[entryKey]) {
                    entryData = clientData.discount[entryKey];
                    entryPath = `clients/${clientKey}/discount/${entryKey}`;
                } else {
                    alert("No entry details found.");
                    return;
                }

                // Display entry details
                loadEntryDetails(entryData);

                // Set up bottom sheet for editing
                document.querySelector(".edit-entry").addEventListener("click", () => {
                    openBottomSheet(entryData, entryPath);
                });
            } else {
                alert("Client data not found.");
            }
        } catch (error) {
            console.error("Error fetching data:", error);
        }
    });

    function loadEntryDetails(entry) {
        const typeElement = document.querySelector(".content .type");
        const amountElement = document.querySelector(".content .amount");
        const clientNameElement = document.querySelector(".content .client");
        const dateTimeElement = document.querySelector(".content .date_and_time");
        const additionalInfoDiv = document.querySelectorAll(".Additional")[0];

        typeElement.textContent = entry.type || "Unknown Type";

        if (entry.type === "JCB" || entry.type === "Tipper") {
            amountElement.textContent = entry.totalAmount || entry.amount || "N/A";
        } else {
            amountElement.textContent = entry.amount || "N/A";
        }

        if (entry.type === "Discount") {
            amountElement.style.color = "gold";
        } else if (entry.type === "Payment") {
            amountElement.style.color = "red";
        } else {
            amountElement.style.color = "#00e676";
        }

        const dateTime = entry.date && entry.time ? `${entry.date}, ${entry.time}` : "N/A";
        dateTimeElement.textContent = `On ${dateTime}`;

        let additionalInfoHtml = "";
        if (entry.type === "JCB") {
            additionalInfoHtml += `
                <p><strong>Starting:</strong> ${entry.starting || "N/A"}</p>
                <p><strong>Ending:</strong> ${entry.ending || "N/A"}</p>
                <p><strong>Difference:</strong> ${entry.difference || "N/A"}</p>
                <p><strong>Rate:</strong> ${entry.rate || "N/A"}</p>
            `;
            if (entry.shifting) {
                additionalInfoHtml += `<p><strong>Shifting Amount:</strong> ${entry.shiftingAmount || "N/A"}</p>`;
            }
        } else if (entry.type === "Tipper") {
            additionalInfoHtml += `
                <p><strong>Amount:</strong> ${entry.amount || "N/A"}</p>
                <p><strong>Load:</strong> ${entry.load || "N/A"}</p>
                <p><strong>Remarks:</strong> ${entry.remarks || "N/A"}</p>
            `;
        } else if (entry.type === "Discount" || entry.type === "Payment") {
            additionalInfoHtml += `<p><strong>Remarks:</strong> ${entry.remarks || "N/A"}</p>`;
        }

        additionalInfoDiv.innerHTML = additionalInfoHtml;
    }

    function openBottomSheet(entry, entryPath) {
    const bottomSheet = document.getElementById("editModal");
    const fieldsContainer = document.getElementById("typeFields");

    // Clear existing fields
    fieldsContainer.innerHTML = "";

    // Generate fields based on entry type
    if (entry.type === "JCB") {
        fieldsContainer.innerHTML = `
            <label>Date: <input type="date" id="editDate" value="${entry.date || ""}"></label>
            <label>Time: <input type="time" id="editTime" value="${entry.time || ""}"></label>
            <label>Starting: <input type="number" id="editStarting" value="${entry.starting || ""}"></label>
            <label>Ending: <input type="number" id="editEnding" value="${entry.ending || ""}"></label>
            <label>Rate: <input type="number" id="editRate" value="${entry.rate || ""}"></label>
            <label>Shifting: <input type="checkbox" id="editShifting" ${entry.shifting ? "checked" : ""}></label>
            <label>Shifting Amount: <input type="number" id="editShiftingAmount" value="${entry.shiftingAmount || ""}" ${entry.shifting ? "" : "disabled"}></label>
        `;
        document.getElementById("editShifting").addEventListener("change", (e) => {
            document.getElementById("editShiftingAmount").disabled = !e.target.checked;
        });
    } else if (entry.type === "Tipper") {
        fieldsContainer.innerHTML = `
            <label>Date: <input type="date" id="editDate" value="${entry.date || ""}"></label>
            <label>Time: <input type="time" id="editTime" value="${entry.time || ""}"></label>
            <label>Load: <input type="number" id="editLoad" value="${entry.load || ""}"></label>
            <label>Remarks: <input type="text" id="editRemarks" value="${entry.remarks || ""}"></label>
            <label>Amount: <input type="number" id="editAmount" value="${entry.amount || ""}"></label>
        `;
    } else if (entry.type === "Discount" || entry.type === "Payment") {
        fieldsContainer.innerHTML = `
            <label>Date: <input type="date" id="editDate" value="${entry.date || ""}"></label>
            <label>Time: <input type="time" id="editTime" value="${entry.time || ""}"></label>
            <label>Amount: <input type="number" id="editAmount" value="${entry.amount || ""}"></label>
            <label>Remarks: <input type="text" id="editRemarks" value="${entry.remarks || ""}"></label>
        `;
    }

    // Show bottom sheet with a smooth transition
    bottomSheet.classList.add("open");

    // Close button functionality
    document.getElementById("closeBtn").addEventListener("click", closeBottomSheet);
    
    // Optional: Close on clicking outside the bottom sheet (overlay click)
    const overlay = document.querySelector(".overlay");
    if (overlay) {
        overlay.addEventListener("click", closeBottomSheet);
    }

    // Handle form submission
    document.getElementById("editForm").onsubmit = async (event) => {
        event.preventDefault();

        let updates = {};
        if (entry.type === "JCB") {
            const starting = parseFloat(document.getElementById("editStarting").value);
            const ending = parseFloat(document.getElementById("editEnding").value);
            const rate = parseFloat(document.getElementById("editRate").value);
            const shifting = document.getElementById("editShifting").checked;
            const shiftingAmount = shifting ? parseFloat(document.getElementById("editShiftingAmount").value) : 0;
updates = {
    date: document.getElementById("editDate").value,
    time: document.getElementById("editTime").value,
    starting,
    ending,
    rate,
    shifting,
    shiftingAmount,
    difference: parseFloat((ending - starting).toFixed(2)), // Restrict to 2 decimal places
    totalAmount: parseFloat(((ending - starting) * rate + shiftingAmount).toFixed(2)), // Restrict to 2 decimal places
};

            
        } else if (entry.type === "Tipper") {
            const load = parseFloat(document.getElementById("editLoad").value);
            const amount = parseFloat(document.getElementById("editAmount").value);

            updates = {
                date: document.getElementById("editDate").value,
                time: document.getElementById("editTime").value,
                load,
                amount,
                remarks: document.getElementById("editRemarks").value,
                totalAmount: load * amount,
            };
        } else if (entry.type === "Discount" || entry.type === "Payment") {
            updates = {
                date: document.getElementById("editDate").value,
                time: document.getElementById("editTime").value,
                amount: parseFloat(document.getElementById("editAmount").value),
                remarks: document.getElementById("editRemarks").value,
            };
        }

        try {
            const entryRef = ref(database, entryPath);
            await update(entryRef, updates);
            alert("Entry updated successfully!");
            location.reload(); // Reload the page to reflect changes
        } catch (error) {
            console.error("Error updating entry:", error);
            alert("Failed to update entry.");
        }
    };
}

// Close the bottom sheet with smooth transition
function closeBottomSheet() {
    const bottomSheet = document.getElementById("editModal");
    const overlay = document.querySelector(".overlay");

    bottomSheet.classList.remove("open");
    if (overlay) {
        overlay.remove(); // Remove overlay background if any
    }
}
document.addEventListener("DOMContentLoaded", () => {
    const deleteIcon = document.querySelector(".delete-icon");

    deleteIcon.addEventListener("click", () => {
        // Create confirmation modal
        const overlay = document.createElement("div");
        overlay.classList.add("overlay");

        const confirmModal = document.createElement("div");
        confirmModal.classList.add("confirm-modal");
        confirmModal.innerHTML = `
            <h3>Confirm Deletion</h3>
            <p>Are you sure you want to delete this entry? This action cannot be undone.</p>
            <div class="modal-actions">
                <button class="cancel-button">Cancel</button>
                <button class="confirm-button">Delete</button>
            </div>
        `;
        document.body.appendChild(overlay);
        document.body.appendChild(confirmModal);

        // Close modal on cancel
        const cancelButton = confirmModal.querySelector(".cancel-button");
        cancelButton.addEventListener("click", () => {
            document.body.removeChild(confirmModal);
            document.body.removeChild(overlay);
        });

        // Handle delete confirmation
        const confirmButton = confirmModal.querySelector(".confirm-button");
        confirmButton.addEventListener("click", async () => {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const clientKey = urlParams.get("clientKey");
                const entryKey = urlParams.get("entryKey");

                if (!clientKey || !entryKey) {
                    alert("Invalid request. Missing clientKey or entryKey.");
                    return;
                }

                // Reference to the client in the database
                const clientRef = ref(database, `clients/${clientKey}`);
                const snapshot = await get(clientRef);

                if (snapshot.exists()) {
                    let entryPath = null;
                    const clientData = snapshot.val();

                    // Determine the correct entry location
                    if (clientData.workDetails && clientData.workDetails[entryKey]) {
                        entryPath = `clients/${clientKey}/workDetails/${entryKey}`;
                    } else if (clientData.paymentReceived && clientData.paymentReceived[entryKey]) {
                        entryPath = `clients/${clientKey}/paymentReceived/${entryKey}`;
                    } else if (clientData.discount && clientData.discount[entryKey]) {
                        entryPath = `clients/${clientKey}/discount/${entryKey}`;
                    }

                    if (entryPath) {
                        const entryRef = ref(database, entryPath);
                        await remove(entryRef); // Use remove() to delete the entry
                        alert("Entry deleted successfully!");
                        window.history.back(); // Go to the previous page
                    } else {
                        alert("Entry not found.");
                    }
                } else {
                    alert("Client data not found.");
                }
            } catch (error) {
                console.error("Error deleting entry:", error);
                alert("Failed to delete entry.");
            } finally {
                // Remove modal and overlay
                document.body.removeChild(confirmModal);
                document.body.removeChild(overlay);
            }
        });
    });
});

const shareButton = document.querySelector(".share-entry");
const modal = document.getElementById("modal");
const closeModalButton = document.getElementById("closeModal");
const shareWhatsAppButton = document.getElementById("shareButton");
const canvas = document.getElementById("invoiceCanvas");

shareButton.addEventListener("click", () => {
    // Generate the invoice based on the current UI details
    generateInvoiceFromUI();

    // Show the modal or sharing options
    modal.classList.remove("hidden");
});

closeModalButton.addEventListener("click", () => {
    modal.classList.add("hidden");
});

shareWhatsAppButton.addEventListener("click", async () => {
    const imageUrl = canvas.toDataURL("image/jpeg");

    if (navigator.share) {
        try {
            const blob = await fetch(imageUrl).then(res => res.blob());
            const file = new File([blob], "invoice.jpg", { type: blob.type });
            await navigator.share({
                files: [file],
                title: "Invoice",
                text: "Here is your invoice!",
            });
        } catch (error) {
            console.error("Sharing failed", error);
        }
    } else {
        alert("Sharing not supported on this device.");
    }
});

function generateInvoiceFromUI() {
    const typeElement = document.querySelector(".content .type");
    const amountElement = document.querySelector(".content .amount");
    const dateTimeElement = document.querySelector(".content .date_and_time");
    const additionalInfoDiv = document.querySelector(".Additional");
    const clientNameElement = document.querySelector(".content .client");

    const type = typeElement.textContent || "Unknown Type";
    const amount = amountElement.textContent || "N/A";
    const dateTime = dateTimeElement.textContent.replace("On ", "") || "N/A";
    const clientName = clientNameElement.textContent || "Unknown Client";
    const additionalInfoHtml = additionalInfoDiv.innerHTML;

    // Parse additional details from innerHTML
    const additional = {};
    additionalInfoHtml.replace(/<p><strong>([^:]+):<\/strong>\s?([^<]+)<\/p>/g, (_, key, value) => {
        additional[key.toLowerCase()] = value.trim();
    });

    const canvas = document.getElementById("invoiceCanvas");
    const ctx = canvas.getContext("2d");

    // Set canvas dimensions
    canvas.width = 800;
    canvas.height = 1000;

    // Clear canvas
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Background with gradient
    const gradient = ctx.createLinearGradient(0, 0, canvas.width, 0);
    gradient.addColorStop(0, "#f0f4fc");
    gradient.addColorStop(1, "#d9e9f9");
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Header
    ctx.fillStyle = "#00509d";
    ctx.fillRect(0, 0, canvas.width, 100);
    ctx.fillStyle = "#fff";
    ctx.font = "bold 30px 'Poppins'";
    ctx.fillText("AL AMEEN EARTHMOVERS", 30, 60);

    // Invoice Title
    ctx.fillStyle = "#f4f4f9";
    ctx.font = "24px 'Roboto'";
    ctx.fillText("Invoice", canvas.width - 150, 60);

    // Client Details Section
    ctx.fillStyle = "#fff";
    ctx.fillRect(20, 120, canvas.width - 40, 150);
    ctx.fillStyle = "#000";
    ctx.font = "18px 'Poppins'";
    ctx.fillText("Client Details", 40, 150);
    ctx.fillText(`Name: ${clientName}`, 40, 180);
    ctx.fillText(`Date & Time: ${dateTime}`, 40, 210);

    ctx.fillStyle = "#00509d";
    ctx.fillText("Invoice Details", 400, 150);
    ctx.fillStyle = "#000";
    ctx.fillText(`Type: ${type}`, 400, 180);
    ctx.fillText(`Amount: ₹${amount}`, 400, 210);

    // Summary Section
    ctx.fillStyle = "#003F88";
    ctx.fillRect(20, 300, canvas.width - 40, 50);
    ctx.fillStyle = "#fff";
    ctx.font = "20px 'Roboto'";
    ctx.fillText("Summary", 30, 335);

    // Table Headers
    ctx.fillStyle = "#ddd";
    ctx.fillRect(20, 360, canvas.width - 40, 30);
    ctx.fillStyle = "#000";
    ctx.font = "16px 'Roboto'";
    ctx.fillText("Description", 40, 380);
    ctx.fillText("Quantity", 300, 380);
    ctx.fillText("Price", 500, 380);

    // Populate Rows Based on Type
    let y = 410;

    if (type === "JCB") {
        // Row 1: Working Time
        const difference = parseFloat(additional["difference"] || 0).toFixed(2);
        const rate = parseFloat(additional["rate"] || 0).toFixed(2);
        const workingTimePrice = (difference * rate).toFixed(2);

        ctx.fillStyle = "#000";
        ctx.fillText("Working Time", 40, y);
        ctx.fillText(difference, 300, y);
        ctx.fillText(`₹${workingTimePrice}`, 500, y);
        y += 30;

        // Row 2: Shifting (if applicable)
        if (additional["shifting amount"]) {
            const shiftingAmount = parseFloat(additional["shifting amount"] || 0).toFixed(2);

            ctx.fillText("Shifting", 40, y);
            ctx.fillText("N/A", 300, y);
            ctx.fillText(`₹${shiftingAmount}`, 500, y);
            y += 30;
        }
    } else if (type === "Tipper") {
        // Row 1: Tipper
        const load = parseFloat(additional["load"] || 0).toFixed(2);
        const amountPerLoad = parseFloat(additional["amount"] || 0).toFixed(2);
        const tipperPrice = (load * amountPerLoad).toFixed(2);

        ctx.fillStyle = "#000";
        ctx.fillText("Tipper", 40, y);
        ctx.fillText(load, 300, y);
        ctx.fillText(`₹${tipperPrice}`, 500, y);
        y += 30;
    }
    // Total Amount
    ctx.fillStyle = "#00509d";
    ctx.fillRect(20, y + 20, canvas.width - 40, 50);
    ctx.fillStyle = "#fff";
    ctx.font = "18px 'Poppins'";
    ctx.fillText("Total", 40, y + 50);
    ctx.font = "24px 'Roboto'";
    ctx.fillText(`₹${amount}`, canvas.width - 150, y + 50);

    // Additional Information
    ctx.fillStyle = "#f4f4f9";
    ctx.fillRect(20, y + 100, canvas.width - 40, 100);
    ctx.fillStyle = "#000";
    ctx.font = "16px 'Roboto'";
    ctx.fillText("Additional Information:", 30, y + 130);
    const additionalInfoLines = additionalInfoHtml.replace(/<\/?[^>]+(>|$)/g, "").split("\n");
    additionalInfoLines.forEach((line, index) => {
        ctx.fillText(line.trim(), 30, y + 160 + index * 20);
    });
    // Footer
    ctx.fillStyle = "#003F88";
    ctx.fillRect(0, canvas.height - 120, canvas.width, 120);
    ctx.fillStyle = "#fff";
    ctx.font = "20px 'Poppins'";
    ctx.fillText("Thank you for your business!", 30, canvas.height - 80);
    ctx.font = "16px 'Roboto'";
    ctx.fillText("Contact us: 8848020782 | 8129417425", 30, canvas.height - 50);
}



</script>

</head>
<body>
    <div class="header">
<a href="javascript:void(0);" onclick="history.back();">
    <i class="fas fa-arrow-left"></i>
</a>


        <div class="title">Entry Details</div>
<div class="status">
    <i class="fas fa-trash-alt delete-icon"></i>
</div>

    </div>
    <div class="container">
        <div class="content">
            <div class="type">Type</div>
            <div class="amount">00</div>
            <div class="date_and_time">On </div>
            <div class="client">client name </div>
            <div class="edit-entry"><i class="fas fa-edit"></i> EDIT ENTRY</div>
        </div>
        <div class="information">
            <div class="label">Additional Information</div>
             <div class="Additional"></div>
        </div>
<div class="bottom-sheet" id="editModal">
    <div class="sheet-content">
        <button class="close-btn" id="closeBtn">&times;</button>
        <h3>Edit Entry</h3>
        <form id="editForm">
            <!-- Dynamic Fields -->
            <div id="typeFields"></div>

            <!-- Submit Button -->
            <button type="submit" class="save-button">Save Changes</button>
        </form>
    </div>
</div>

    </div>



    <div class="share-entry modern-button">
    <i class="fab fa-whatsapp"></i> Share Invoice
</div>

<div id="modal" class="modal hidden">
    <div class="modal-content">
        <h2>Preview Invoice</h2>
        <canvas id="invoiceCanvas" style="width: 100%; height: auto;"></canvas>
        <div class="modal-actions">
            <button id="shareButton" class="modern-button">Share on WhatsApp</button>
            <button id="closeModal" class="modern-button secondary">Close</button>
        </div>
    </div>
</div>
</body>
</html>
